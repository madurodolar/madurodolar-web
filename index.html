<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MaduroDólar</title>

  <!-- Ícono para SEO/Bookmarks -->
  <link rel="icon" href="logo.png" type="image/png" />

  <!-- Meta description / Open Graph mínimos -->
  <meta name="description" content="Consulta en tiempo real la tasa del dólar paralelo (Binance P2P) y la tasa oficial (BCV) en Venezuela. Actualización cada minuto." />
  <meta property="og:title" content="MaduroDólar – USD/VES Paralelo y Oficial" />
  <meta property="og:description" content="Consulta en tiempo real la tasa del dólar paralelo (Binance P2P) y la tasa oficial (BCV) en Venezuela." />
  <meta property="og:image" content="https://www.madurodolar.com/logo.png" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">

    <!-- ───────────────────────────────────────────────────────────
         LOGO
    ─────────────────────────────────────────────────────────── -->
    <img
      src="logo.png"
      alt="Logo MaduroDólar"
      class="logo"
      onerror="this.onerror=null; this.src='logo.png'"
    />

    <!-- ───────────────────────────────────────────────────────────
         TARJETA #1: Binance P2P (automático)
    ─────────────────────────────────────────────────────────── -->
    <div class="card">
      <h2>Precio paralelo USD/VES (Binance P2P)</h2>
      <p class="rate">
        <strong>Venta:</strong>
        <span id="sell" class="value">‒</span> VES<br />
        <strong>Compra:</strong>
        <span id="buy" class="value">‒</span> VES
      </p>
      <p id="updated-binance" class="updated">
        Última actualización: <span>‒</span>
      </p>
    </div>

    <!-- ───────────────────────────────────────────────────────────
         TARJETA #2: Dólar BCV (manual desde bcv.json)
    ─────────────────────────────────────────────────────────── -->
    <div class="card">
      <h2>Precio oficial USD/VES (Dólar BCV)</h2>
      <p class="rate">
        <strong>Tasa BCV:</strong>
        <span id="bcv" class="value">‒</span> VES
      </p>
      <p id="updated-bcv" class="updated">
        Última actualización: <span>‒</span>
      </p>
    </div>

    <!-- ───────────────────────────────────────────────────────────
         ICONOS SOCIALES
    ─────────────────────────────────────────────────────────── -->
    <p class="telegram">
      Síguenos en nuestras cuentas:
      <a href="https://t.me/madurodolar" target="_blank" rel="noopener noreferrer">
        <img src="telegram.png" alt="Telegram MaduroDólar" class="icon" />
      </a>
      <a href="https://www.instagram.com/madurodolar" target="_blank" rel="noopener noreferrer">
        <img src="instagram.png" alt="Instagram MaduroDólar" class="icon" />
      </a>
      <a href="https://x.com/madurodolar" target="_blank" rel="noopener noreferrer">
        <img src="x.png" alt="X MaduroDólar" class="icon" />
      </a>
    </p>

    <p class="footer">
      Datos actualizados cada minuto vía servidor Backend
      <br />
      Tasa BCV actualizada manualmente vía <code>bcv.json</code>
    </p>
  </div>

  <!-- ───────────────────────────────────────────────────────────
       JAVASCRIPT PARA ACTUALIZAR LOS VALORES EN PANTALLA
  ─────────────────────────────────────────────────────────── -->
  <script>
    // Referencias a los elementos del DOM
    const SELL_EL = document.getElementById("sell");
    const BUY_EL = document.getElementById("buy");
    const UPDATED_BINANCE_EL = document.querySelector("#updated-binance span");

    const BCV_EL = document.getElementById("bcv");
    const UPDATED_BCV_EL = document.querySelector("#updated-bcv span");

    // Helper: formatea un objeto Date en "DD/MM/YYYY, HH:MM:SS" (es-VE)
    function formatDate(date) {
      if (!(date instanceof Date) || isNaN(date)) {
        return "‒";
      }
      return date.toLocaleString("es-VE", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
      });
    }

    // ───────────────────────────────────────────────────────────
    // 1) CARGAR la tasa de Binance P2P (automático, desde price.json o desde /api/binance)
    // ───────────────────────────────────────────────────────────
    function loadBinance() {
      // Si quieres leerlo directamente de price.json (generado por GitHub Actions),
      // usa: fetch("price.json")
      // Si prefieres invocar tu servidor backend, usa:
      fetch("/api/binance")
        .then((res) => {
          if (!res.ok) throw new Error("Network response was not OK");
          return res.json();
        })
        .then((data) => {
          // data → { sell:"132.450", buy:"131.000", updated:"2025-06-06T12:54:37.436Z" }
          let sellF = parseFloat(data.sell);
          let buyF = parseFloat(data.buy);
          let dt = new Date(data.updated);

          SELL_EL.textContent = isNaN(sellF) ? "Error" : sellF.toFixed(2);
          BUY_EL.textContent = isNaN(buyF) ? "Error" : buyF.toFixed(2);
          UPDATED_BINANCE_EL.textContent = isNaN(dt) ? "Error" : formatDate(dt);
        })
        .catch((err) => {
          console.error("Error obteniendo Binance P2P:", err);
          SELL_EL.textContent = "Error";
          BUY_EL.textContent = "Error";
          UPDATED_BINANCE_EL.textContent = "Error";
        });
    }

    // ───────────────────────────────────────────────────────────
    // 2) CARGAR la tasa BCV de forma manual (desde bcv.json)
    // ───────────────────────────────────────────────────────────
    function loadBCV() {
      fetch("bcv.json")
        .then((res) => {
          if (!res.ok) throw new Error("No se pudo cargar bcv.json");
          return res.json();
        })
        .then((data) => {
          // data → { rate:174231.00, updated:"2025-06-06T13:00:00.000Z" }
          let rateF = parseFloat(data.rate);
          let dt = new Date(data.updated);

          BCV_EL.textContent = isNaN(rateF) ? "Error" : rateF.toFixed(2);
          UPDATED_BCV_EL.textContent = isNaN(dt) ? "Error" : formatDate(dt);
        })
        .catch((err) => {
          console.error("Error cargando BCV (bcv.json):", err);
          BCV_EL.textContent = "Error";
          UPDATED_BCV_EL.textContent = "Error";
        });
    }

    // Ejecutamos ambas funciones al cargar la página:
    loadBinance();
    loadBCV();

    // (Opcional) Si deseas actualizar cada 60 segundos:
    // setInterval(() => { loadBinance(); loadBCV(); }, 60000);
  </script>
</body>
</html>
