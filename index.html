<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MaduroDólar</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">

    <!-- ───────────────────────────────────────────────────────────
         LOGO
    ─────────────────────────────────────────────────────────── -->
    <img
      src="logo.png"
      alt="Logo MaduroDólar"
      class="logo"
      onerror="this.onerror=null; this.src='logo.png'"
    />

    <!-- ───────────────────────────────────────────────────────────
         CARD #1: Binance P2P
    ─────────────────────────────────────────────────────────── -->
    <div class="card">
      <h2>Precio paralelo USD/VES (Binance P2P)</h2>
      <p class="rate">
        <strong>Venta:</strong>
        <span id="sell" class="value">‒</span> VES<br />
        <strong>Compra:</strong>
        <span id="buy" class="value">‒</span> VES
      </p>
      <p id="updated-binance" class="updated">
        Última actualización: <span>‒</span>
      </p>
    </div>

    <!-- ───────────────────────────────────────────────────────────
         CARD #2: Dólar BCV
    ─────────────────────────────────────────────────────────── -->
    <div class="card">
      <h2>Precio oficial USD/VES (Dólar BCV)</h2>
      <p class="rate">
        <strong>Tasa BCV:</strong>
        <span id="bcv" class="value">‒</span> VES
      </p>
      <p id="updated-bcv" class="updated">
        Última actualización: <span>‒</span>
      </p>
    </div>

    <!-- ───────────────────────────────────────────────────────────
         SOCIAL ICONS
    ─────────────────────────────────────────────────────────── -->
    <p class="telegram">
      Síguenos en nuestras cuentas:
      <a href="https://t.me/madurodolar" target="_blank" rel="noopener noreferrer">
        <img
          src="telegram.sgv"
          alt="Telegram MaduroDólar"
          class="icon"
        />
      </a>
      <a href="https://www.instagram.com/madurodolar" target="_blank" rel="noopener noreferrer">
        <img
          src="instagram.svg"
          alt="Instagram MaduroDólar"
          class="icon"
        />
      </a>
      <a href="https://x.com/madurodolar" target="_blank" rel="noopener noreferrer">
        <img
          src="x.svg"
          alt="X MaduroDólar"
          class="icon"
        />
      </a>
    </p>

    <p class="footer">
      Datos actualizados cada minuto vía servidor Backend
    </p>
  </div>

  <!-- ───────────────────────────────────────────────────────────
       JAVASCRIPT: Fetch both endpoints & update the DOM
  ─────────────────────────────────────────────────────────── -->
  <script>
    // Cache references to the DOM elements:
    const SELL_EL = document.getElementById("sell");
    const BUY_EL = document.getElementById("buy");
    const UPDATED_BINANCE_EL = document.querySelector("#updated-binance span");

    const BCV_EL = document.getElementById("bcv");
    const UPDATED_BCV_EL = document.querySelector("#updated-bcv span");

    // Helper to format a JS Date to "DD/MM/YYYY, HH:MM:SS" in es-VE locale:
    function formatDate(date) {
      if (!(date instanceof Date) || isNaN(date)) {
        return "Error";
      }
      return date.toLocaleString("es-VE", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
      });
    }

    // ───────────────────────────────────────────────────────────
    // 1) Load Binance P2P Rate
    // ───────────────────────────────────────────────────────────
    function loadBinance() {
      fetch("https://madurodolar-web.onrender.com/api/binance")
        .then((res) => {
          if (!res.ok) throw new Error("Network response was not OK");
          return res.json();
        })
        .then((data) => {
          // data should be { sell:"130.500", buy:"128.000", updated:"2025-06-06T12:54:37.436Z" }
          const sellF = parseFloat(data.sell);
          const buyF = parseFloat(data.buy);
          const dt = new Date(data.updated);

          SELL_EL.textContent = isNaN(sellF) ? "Error" : sellF.toFixed(2);
          BUY_EL.textContent = isNaN(buyF) ? "Error" : buyF.toFixed(2);

          UPDATED_BINANCE_EL.textContent = formatDate(dt);
        })
        .catch((err) => {
          console.error("Error obteniendo Binance P2P:", err);
          SELL_EL.textContent = "Error";
          BUY_EL.textContent = "Error";
          UPDATED_BINANCE_EL.textContent = "Error";
        });
    }

    // ───────────────────────────────────────────────────────────
    // 2) Load Dólar BCV Rate
    // ───────────────────────────────────────────────────────────
    function loadBCV() {
      fetch("https://madurodolar-web.onrender.com/api/bcv")
        .then((res) => {
          if (!res.ok) throw new Error("Network response was not OK");
          return res.json();
        })
        .then((data) => {
          // data should be { rate: 174231.00, updated:"2025-06-06T12:55:00.000Z" }
          const rateF = parseFloat(data.rate);
          const dt = new Date(data.updated);

          BCV_EL.textContent = isNaN(rateF) ? "Error" : rateF.toFixed(2);
          UPDATED_BCV_EL.textContent = formatDate(dt);
        })
        .catch((err) => {
          console.error("Error obteniendo Dólar BCV:", err);
          BCV_EL.textContent = "Error";
          UPDATED_BCV_EL.textContent = "Error";
        });
    }

    // ───────────────────────────────────────────────────────────
    // 3) Run both on page load
    // ───────────────────────────────────────────────────────────
    loadBinance();
    loadBCV();

    // If you ever want to auto-refresh every 60s:
    // setInterval(() => {
    //   loadBinance();
    //   loadBCV();
    // }, 60000);
  </script>
</body>
</html>
